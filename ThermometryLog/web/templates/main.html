{% extends 'base.html' %}

{% block header_content %}
<div style="display: inline-block;">
    <div class="mx-4 btn-toolbar" style="display: inline-flex">
        <form>
            <p style="border-right: 1px solid var(--root-fg); padding-right: 1rem;"><strong class="lg:inline-block" style="display: none">Дата:</strong> <input type="date" value="{{date}}" id="date"></p>
            <script type="text/javascript">
                let date = window.document.getElementById("date");
                let olddate = date.value;
                let isChanged = function(){
                    if(date.value !== olddate){
                        olddate = date.value;
                        return true;
                      };
                      return false;
                };
                date.addEventListener("blur", function(){
                    if(isChanged())
                        pywebview.api.open_url('?group={{group}}&date=' + olddate)
                });
            </script>
        </form>
        <button class="btn button btn-sm" type="button" style="margin-left: 1rem; margin-bottom: 1rem;" data-bs-toggle="modal" data-bs-target="#addLogModal">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="lg:inline-block bi bi-plus-circle-fill mr-2" viewBox="0 0 16 16" style="display: none">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>
            </svg>
            <label class="mx-2">Добавить</label>
        </button>
        <button class="btn button btn-sm" type="button" style="margin-left: 1rem; margin-bottom: 1rem;" data-bs-toggle="modal" data-bs-target="#globalEditLogModal">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="lg:inline-block bi bi-pencil-fill" viewBox="0 0 16 16" style="display: none">
                <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
            </svg>
            <label class="mx-2">Изменить</label>
        </button>
        <form class="search" style="margin-left: 1rem; margin-bottom: 1rem;" method="get" action="/search">
            <input type="hidden" name="date" value="{{date}}">
            <input type="hidden" name="group" value="{{group}}">
            <input name="search" type="text" placeholder="Имя, температура" required>
            <button type="submit"></button>
        </form>
    </div>
    <div class="row">
        <div class="col stat-block stat-block-start">
            Всего записей
            <h1>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-journals" viewBox="0 0 16 16">
                    <path d="M5 0h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2 2 2 0 0 1-2 2H3a2 2 0 0 1-2-2h1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1H1a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v9a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1H3a2 2 0 0 1 2-2z"/>
                    <path d="M1 6v-.5a.5.5 0 0 1 1 0V6h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V9h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 2.5v.5H.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1H2v-.5a.5.5 0 0 0-1 0z"/>
                </svg>
                {{logs|length}}
            </h1>
        </div>
        <div class="col stat-block">
            Средняя температура
            <h1>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-thermometer-half" viewBox="0 0 16 16">
                    <path d="M9.5 12.5a1.5 1.5 0 1 1-2-1.415V6.5a.5.5 0 0 1 1 0v4.585a1.5 1.5 0 0 1 1 1.415z"/>
                    <path d="M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1z"/>
                </svg>
                {{average_temp}}
            </h1>
        </div>
        <div class="col stat-block">
            Максимальная температура
            <h1>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-thermometer-high" viewBox="0 0 16 16">
                    <path d="M9.5 12.5a1.5 1.5 0 1 1-2-1.415V2.5a.5.5 0 0 1 1 0v8.585a1.5 1.5 0 0 1 1 1.415z"/>
                    <path d="M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1z"/>
                </svg>
                {{max_temp}}
            </h1>
        </div>
        <div class="col stat-block stat-block-end">
            Минимальная температура
            <h1>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-thermometer-high" viewBox="0 0 16 16">
                    <path d="M9.5 12.5a1.5 1.5 0 1 1-2-1.415V9.5a.5.5 0 0 1 1 0v1.585a1.5 1.5 0 0 1 1 1.415z"/>
                    <path d="M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1z"/>
                </svg>
                {{min_temp}}
            </h1>
        </div>
    </div>
</div>
{% endblock %}

{% block body %}

{% if not_inited_groups|length != 0 %}
<div class="modal fade" id="waitModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: var(--root-bg)">
            <form id="waitForm" method="get">
                <input type="hidden" name="date" value="{{date}}"/>
                <input type="hidden" name="group" value="{{group}}"/>
                <div class="modal-body text-center">
                    <div class="d-flex justify-content-center py-5">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mx-2">инициализация групп</p>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function(event) {
        var myModal = new bootstrap.Modal(document.getElementById('waitModal'), {
            keyboard: false, backdrop: 'static'
        });
        myModal.show();
    });
</script>
<script type="text/javascript">
    window.addEventListener('pywebviewready', function() {
        pywebview.api.init_groups('{{not_inited_groups}}', '{{date}}');
    })
</script>
{% else %}

<div id="menuButton">
    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M2.5 11.5A.5.5 0 0 1 3 11h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4A.5.5 0 0 1 3 7h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4A.5.5 0 0 1 3 3h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
    </svg>
</div>
<div id="menu" class="p-3">
    <div class="mb-1" data-bs-toggle="modal" data-bs-target="#importLogsModal" onclick="pywebview.api.import_logs('{{date}}', '{{group}}');">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-journal-arrow-down" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 5a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5A.5.5 0 0 1 8 5z"/>
            <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z"/>
            <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"/>
        </svg>
        Импортировать
    </div>
    <div data-bs-toggle="modal" data-bs-target="#exportLogsModal">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-journal-arrow-up" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 11a.5.5 0 0 0 .5-.5V6.707l1.146 1.147a.5.5 0 0 0 .708-.708l-2-2a.5.5 0 0 0-.708 0l-2 2a.5.5 0 1 0 .708.708L7.5 6.707V10.5a.5.5 0 0 0 .5.5z"/>
            <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z"/>
            <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"/>
        </svg>
        Экспортировать
    </div>
    <hr>
    <div onclick="pywebview.api.open_url('/groups?date={{date}}')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people-fill" viewBox="0 0 16 16">
            <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
            <path fill-rule="evenodd" d="M5.216 14A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216z"/>
            <path d="M4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z"/>
        </svg>
        Сменить группу
    </div>
    <hr>
    <div data-bs-toggle="modal" data-bs-target="#colorSchemeModal">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-palette-fill" viewBox="0 0 16 16">
            <path d="M12.433 10.07C14.133 10.585 16 11.15 16 8a8 8 0 1 0-8 8c1.996 0 1.826-1.504 1.649-3.08-.124-1.101-.252-2.237.351-2.92.465-.527 1.42-.237 2.433.07zM8 5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm4.5 3a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zM5 6.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
        </svg>
        Цветовая схема
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function(){
        $('#menuButton').click(function() {
            if ($('#menu').css('display') == 'none') {
                $('#menu').fadeIn();
                $('#menuButton').css('background', 'var(--accent-color)');
                $('#menuButton').css('color', 'var(--header-fg)');
                $('#menuButton').css('border-radius', '5px 5px 0px 0px');
            } else {
                $('#menu').fadeOut();
                $('#menuButton').css('color', '');
                $('#menuButton').css('background', '');
                $('#menuButton').css('border-radius', '');
            };
        });
   });
</script>
<div class="px-3" id="main">
    {% if logs|length > 0 %}
    <table class="table table-hover">
        <thead>
            <tr>
                <th scope="col"><strong>Дата измерения</strong></th>
                <th scope="col"><strong>ФИО человека</strong></th>
                <th scope="col"><strong>Температура</strong></th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline" data-log-id="{{log.id}}" data-bs-toggle="modal" data-bs-target="#deleteLogModal">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash2-fill" viewBox="0 0 16 16">
                                <path d="M2.037 3.225A.703.703 0 0 1 2 3c0-1.105 2.686-2 6-2s6 .895 6 2a.702.702 0 0 1-.037.225l-1.684 10.104A2 2 0 0 1 10.305 15H5.694a2 2 0 0 1-1.973-1.671L2.037 3.225zm9.89-.69C10.966 2.214 9.578 2 8 2c-1.58 0-2.968.215-3.926.534-.477.16-.795.327-.975.466.18.14.498.307.975.466C5.032 3.786 6.42 4 8 4s2.967-.215 3.926-.534c.477-.16.795-.327.975-.466-.18-.14-.498-.307-.975-.466z"/>
                            </svg>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline" data-name="{{log.name}}" data-temp="{{log.temperature}}" data-log-id="{{log.id}}" data-bs-toggle="modal" data-bs-target="#editLogModal">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
                                <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                            </svg>
                        </button>
                    </div>
                    {{log.date}}{% if log.time != '0' %} {{log.time}}{% endif %}
                </td>
                <td>{{log.name}}</td>
                <td>
                    {% if log.temperature == 0 %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-x" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M6.146 7.146a.5.5 0 0 1 .708 0L8 8.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 9l1.147 1.146a.5.5 0 0 1-.708.708L8 9.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 9 6.146 7.854a.5.5 0 0 1 0-.708z"/>
                        <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                        <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                    </svg>
                    Нет данных
                    {% else %}
                    {% if log.temperature <= 36 %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-thermometer-low" viewBox="0 0 16 16">
                        <path d="M9.5 12.5a1.5 1.5 0 1 1-2-1.415V9.5a.5.5 0 0 1 1 0v1.585a1.5 1.5 0 0 1 1 1.415z"/>
                        <path d="M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1z"/>
                    </svg>
                    {% elif log.temperature <= 37 %}
                    <svg id="temp-icon${log[0]}" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-thermometer-half" viewBox="0 0 16 16">
                        <path d="M9.5 12.5a1.5 1.5 0 1 1-2-1.415V6.5a.5.5 0 0 1 1 0v4.585a1.5 1.5 0 0 1 1 1.415z"/>
                        <path d="M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1z"/>
                    </svg>
                    {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-thermometer-high" viewBox="0 0 16 16">
                        <path d="M9.5 12.5a1.5 1.5 0 1 1-2-1.415V2.5a.5.5 0 0 1 1 0v8.585a1.5 1.5 0 0 1 1 1.415z"/>
                        <path d="M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1z"/>
                    </svg>
                    {% endif %}
                    {{log.temperature}}
                    <div class="progress" style="height: 5px">
                        <div class="progress-bar" role="progressbar"
                             style="width: {{(log.temperature - 30) * 10}}%;background-color:
                             {% if log.temperature|float() <= 35.2 %} var(--temp-color-352)
                             {% elif log.temperature|float() >= 38.0 %} var(--temp-color-380)
                             {% else %} var(--temp-color-{{log.temperature|int()}}{{(log.temperature % 1 * 10)|round()|int()}}, var(--temp-color-{{(log.temperature + 0.1)|int()}}{{((log.temperature + 0.1) % 1 * 10)|round()|int()}}))
                             {% endif %}"
                             aria-valuenow="{{(log.temperature - 30) * 10}}" aria-valuemin="32" aria-valuemax="40">
                        </div>
                    </div>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="container text-center ">
        <h1 class="mt-5">
            Нет записей на это число
            <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-journal" viewBox="0 0 16 16">
                <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z"/>
                <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"/>
            </svg>
        </h1>
        <div class="d-grid gap-2 col-6 mx-auto">
            {% if date != now_date %}
            <button type="button" class="btn button" onclick="pywebview.api.open_url('?group={{group}}')">Перейти к сегодняшнему числу</button>
            {% endif %}
            <button class="btn button" type="button" data-bs-toggle="modal" data-bs-target="#addLogModal">Добавить запись</button>
        </div>
    </div>
    {% endif %}
</div>

<div class="modal fade" id="deleteLogModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: var(--root-bg)">
            <form id="deleteForm" method="get">
                <input type="hidden" name="date" value="{{date}}"/>
                <input type="hidden" name="group" value="{{group}}"/>
                <div id="deleteModalBody">
                    <div class="modal-header">
                        <h5 class="modal-title">Удалить запись?</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Запись будет не возможно восстановить.
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" data-bs-dismiss="modal">Отмена</button>
                        <button type="button" class="btn btn-danger" id="deleteLogModalBtn" data-log-id="">Удалить</button>
                        <script type="text/javascript">
                            document.getElementById('deleteLogModalBtn').onclick = function() {
                                pywebview.api.delete_log(this.dataset.logId)
                            };
                        </script>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript">
    let deleteLogModal = document.getElementById('deleteLogModal');
    let deleteLogModalBtn = document.getElementById('deleteLogModalBtn');
    deleteLogModal.addEventListener('show.bs.modal', function (event) {
        let targetButton = event.relatedTarget;
        deleteLogModalBtn.dataset.logId = targetButton.dataset.logId;
    });
</script>
<div class="modal fade" id="editLogModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: var(--root-bg)">
            <form id="editForm" method="get">
                <input type="hidden" name="date" value="{{date}}"/>
                <input type="hidden" name="group" value="{{group}}"/>
                <div id="editModalBody">
                    <div class="modal-header">
                        <h5 class="modal-title">Редактирование записи</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="nameInput" class="form-label">ФИО человека</label>
                            <input type="text" class="form-control" id="nameInput" required>
                        </div>
                        <div class="mb-3">
                            <label for="tempInput" class="form-label">Температура</label>
                            <input type="number" class="form-control" id="tempInput" step="0.1" max="40" min="32" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                        <button type="button" class="btn btn-success" id="editLogModalBtn" data-log-id="">Сохранить</button>
                        <script type="text/javascript">
                            document.getElementById('editLogModalBtn').onclick = function() {
                                let nameInput = document.getElementById('nameInput');
                                let tempInput = document.getElementById('tempInput');
                                pywebview.api.edit_log(this.dataset.logId, nameInput.value, tempInput.value)
                            };
                        </script>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript">
    let editLogModal = document.getElementById('editLogModal');
    let editLogModalBtn = document.getElementById('editLogModalBtn');
    editLogModal.addEventListener('show.bs.modal', function (event) {
        let targetButton = event.relatedTarget;
        editLogModalBtn.dataset.logId = targetButton.dataset.logId;
        nameInput.value = targetButton.dataset.name;
        if (targetButton.dataset.temp > 0) {
            tempInput.value = targetButton.dataset.temp;
        } else {
            tempInput.value = 36.6;
        };
    });
</script>
<div class="modal fade" id="addLogModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: var(--root-bg)">
            <form id="addForm" method="get">
                <input type="hidden" name="date" value="{{date}}"/>
                <input type="hidden" name="group" value="{{group}}"/>
                <div id="addModalBody">
                    <div class="modal-header">
                        <h5 class="modal-title">Создание новой записи</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="newNameInput" class="form-label">ФИО человека</label>
                            <input type="text" class="form-control" id="newNameInput" required>
                        </div>
                        <div class="mb-3">
                            <label for="newTempInput" class="form-label">Температура</label>
                            <input type="number" class="form-control" id="newTempInput" value="36.6" step="0.1" max="40" min="32" required>
                        </div>
                        <div class="mb-3">
                            <label for="newDateInput" class="form-label">Дата</label>
                            <input type="date" class="form-control" id="newDateInput" value="{{date}}" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                        <button type="button" class="btn btn-success" id="addLogModalBtn">Добавить</button>
                        <script type="text/javascript">
                            document.getElementById('addLogModalBtn').onclick = function() {
                                let newNameInput = document.getElementById('newNameInput');
                                let newTempInput = document.getElementById('newTempInput');
                                let newDateInput = document.getElementById('newDateInput');
                                pywebview.api.add_log(newNameInput.value, newTempInput.value, newDateInput.value, '{{group}}');
                            };
                        </script>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="globalEditLogModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: var(--root-bg)">
            <form id="globalEditForm" method="get">
                <input type="hidden" name="date" value="{{date}}"/>
                <input type="hidden" name="group" value="{{group}}"/>
                <div id="globalEditModalBody">
                    <div class="modal-header">
                        <h5 class="modal-title">Редактирование записи в группе</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <label for="groupSelect" class="form-label">Группа</label>
                        <select id="groupSelect" class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
                            {% for grp in groups %}
                            <option value="{{grp}}">{{grp}}</option>
                            {% endfor %}
                        </select>
                        <div class="mb-3">
                            <label for="newNameInput" class="form-label">ФИО человека</label>
                            <input type="text" class="form-control" id="globalNameInput" list="names" required>
                            <datalist id="names"></datalist>
                        </div>
                        <div class="mb-3">
                            <label for="newTempInput" class="form-label">Температура</label>
                            <input type="number" class="form-control" id="globalTempInput" value="36.6" step="0.1" max="40" min="32" required>
                        </div>
                        <div class="mb-3">
                            <label for="newDateInput" class="form-label">Дата</label>
                            <input type="date" class="form-control" id="globalDateInput" value="{{date}}" required>
                        </div>
                        <script type="text/javascript">
                            document.getElementById('groupSelect').onchange = function() {
                                pywebview.api.get_group_members(this.value).then(function(names) {
                                    var nl = document.getElementById('names');
                                    nl.innerHTML = '';
                                    names.forEach(function(item, i, names) {
                                        var el = document.createElement('option');
                                        el.innerHTML = item;
                                        nl.appendChild(el);
                                    });
                                });
                            };
                            window.addEventListener('pywebviewready', function() {
                                pywebview.api.get_group_members(document.getElementById('groupSelect').value).then(function(names) {
                                    var nl = document.getElementById('names');
                                    nl.innerHTML = '';
                                    names.forEach(function(item, i, names) {
                                        var el = document.createElement('option');
                                        el.innerHTML = item;
                                        nl.appendChild(el);
                                    });
                                });
                            })
                        </script>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                        <button type="button" class="btn btn-success" id="globalEditLogModalBtn">Изменить</button>
                        <script type="text/javascript">
                            document.getElementById('globalEditLogModalBtn').onclick = function() {
                                let globalNameInput = document.getElementById('globalNameInput');
                                let globalTempInput = document.getElementById('globalTempInput');
                                let globalDateInput = document.getElementById('globalDateInput');
                                let groupSelect = document.getElementById('groupSelect');
                                pywebview.api.global_edit(globalNameInput.value, globalTempInput.value, globalDateInput.value, groupSelect.value);
                            };
                        </script>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="importLogsModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: var(--root-bg)">
            <form id="importLogsForm" method="get">
                <input type="hidden" name="date" value="{{date}}"/>
                <input type="hidden" name="group" value="{{group}}"/>
                <div class="modal-body text-center" id="importLogsModalBody">
                    <div class="py-5">
                        Выберите файл
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="exportLogsModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: var(--root-bg)">
            <form id="exportLogsForm" method="get">
                <input type="hidden" name="date" value="{{date}}"/>
                <input type="hidden" name="group" value="{{group}}"/>
                <div id="exportLogsModalBody">
                    <div class="modal-header">
                        <h5 class="modal-title">Экспорт записей.</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div>
                            <label for="exportType" class="form-label">Экспорт в:</label>
                            <select id="exportType" class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
                                <option value="excel" selected>Excel</option>
                                <option value="csv">csv</option>
                            </select>
                            <label for="dateSection" class="form-label">Временные рамки</label>
                            <div id="dateSection" class="btn-toolbar justify-content-center">
                                <p class="mx-2">С <input type="date" value="{{date}}" id="startDate"> </p>
                                <p class="mx-2">До <input type="date" value="{{date}}" id="endDate"> </p>
                            </div>
                            <div class="mt-3 form-check" style="display: none;" id="isTemplateDiv">
                                <input type="checkbox" class="form-check-input" id="isTemplate">
                                <label class="form-check-label" for="isTemplate">Экспортировать как шаблон</label>
                            </div>
                            <script type="text/javascript">
                                document.getElementById('exportType').onchange = function() {
                                    if (this.value == 'csv') {
                                        document.getElementById('isTemplateDiv').style.display = 'block';
                                    } else {
                                        document.getElementById('isTemplateDiv').style.display = 'none';
                                    };
                                };
                            </script>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                        <button type="button" class="btn btn-success" id="exportLogsModalBtn">Продолжить</button>
                        <script type="text/javascript">
                            document.getElementById('exportLogsModalBtn').onclick = function() {
                                let exportType = document.getElementById('exportType').value;
                                let startDate = document.getElementById('startDate').value;
                                let endDate = document.getElementById('endDate').value;
                                let isTemplate = document.getElementById('isTemplate').checked;
                                if (startDate > endDate) {
                                    alert('Неверные временные рамки.');
                                } else {
                                    pywebview.api.export_logs(exportType, [startDate, endDate], '{{group}}', isTemplate);
                                };
                            };
                        </script>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="colorSchemeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: var(--root-bg)">
            <form id="settingsForm" method="get">
                <input type="hidden" name="date" value="{{date}}"/>
                <input type="hidden" name="group" value="{{group}}"/>
                <div class="modal-header">
                    <h5 class="modal-title">Выбор цветовой схемы</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <select id="colorScheme" class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
                        <option value="default" selected>Стандартная</option>
                        <option value="light">Светлая</option>
                        <option value="dark">Тёмная</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                    <button type="button" class="btn btn-success" id="settingsModalBtn">Сохранить</button>
                    <script type="text/javascript">
                        document.getElementById('settingsModalBtn').onclick = function() {
                            var cs = document.getElementById('colorScheme').value;
                            pywebview.api.change_color_scheme(cs);
                        };
                    </script>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}